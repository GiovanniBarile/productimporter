{% extends "@PrestaShop/Admin/layout.html.twig" %}
{% block content %}
	{# toggle with "Modalità : Visualizzazione | modifica" #}
	<div class="d-flex justify-content-center align-items-center align-content-center mb-5">
		<span class="h1 m-0 p-0">Modalità:</span>
		<div class="btn-group btn-group-toggle" data-toggle="buttons"> 
			<label class="btn btn-secondary active">
				<input type="radio" name="options" value="view" autocomplete="off" checked>
				Visualizzazione
			</label>
			<label class="btn btn-secondary">
				<input type="radio" name="options" value="edit" autocomplete="off">
				Modifica
			</label>
		</div>

	</div>


	<div class=" d-flex justify-content-around position-relative">

		<div id="loading" class="position-fixed d-none" style="top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(255, 255, 255, 0.8); display: flex; justify-content: center; align-items: center; z-index: 9999; pointer-events: all;">
			<div id="loading" style="background-color: white; padding: 20px; border-radius: 10px; text-align: center;">
				<div class="spinner-border text-primary" role="status"></div>
				<p style="margin-top: 10px; font-weight: bold; color: #333;">Caricamento...</p>
			</div>
		</div>


		<div class="overflow-auto" style="height:70vh">
			<div class="d-flex justify-content-around flex-column mb-3">
				<span class="h1 p-0 m-0">Remote Categories</span>
				<a>Annulla selezione</a>
			</div>
			<div id="remote" class="demo" data-get-remote-mapped-categories-url="{{ path('productimporter-get-remote-mapped-categories') }}">
				<ul>
					{% for parent in remote_categories %}
						{# set root icon for the main  #}
						<li data-jstree='{"opened":true}' data-category-id="{{parent.id}}">
							{{ parent.name }}
							{% if parent.x_children|length > 0 %}
								<ul>
									{% for child in parent.x_children %}
										<li data-category-id="{{child.id}}" data-jstree='{"opened":true}'>
											{{ child.name }}
											{% if child.x_children is defined %}
												<ul>
													{% for child2 in child.x_children %}
														<li data-category-id="{{child2.id}}" data-jstree=''>
															{{ child2.name }}

														</li>
													{% endfor %}
												</ul>
											{% endif %}
										</li>
									{% endfor %}
								</ul>
							{% endif %}
						</li>
					{% endfor %}
				</ul>
			</div>


			{# div with selected category name #}
			<div class="mt-5">
				<p>Selected category:</p>
				<div id="selectedRemoteCategory"></div>
			</div>
		</div>
		<div class="centercol w-10">
			<button id="btn" class="btn btn-primary d-none"
			data-categories-link-url="{{path('productimporter-categories-link')}}"
			>Collega</button>
		</div>
		<div>
			<div class="d-flex justify-content-around align-items-center align-content-center d-none" id="categoryCrud">
				<span class="h1 m-0 p-0">Local Categories</span>
				<div class="d-none" id="editCategoryButtons">
				<button type="button" class="btn btn-action btn-sm ml-4" data-toggle="modal" data-target="#addCategoryModal">
					<i class="material-icons">add</i>
				</button>
				<button type="button" disabled class="btn btn-action btn-sm ml-4" id="editCategoryButton" data-toggle="modal" data-target="#editCategoryModal" data-category-id="" data-category-name="">
					<i class="material-icons">edit</i>
				</button>
				</div>
			</div>

			<div id="local" class="demo" data-get-local-mapped-categories-url="{{ path('productimporter-get-local-mapped-categories') }}" data-delete-category-url="{{ path('productimporter-categories-delete') }}">
				<ul>
					{% for parent in categories %}
						<li data-jstree='{"opened":true}' data-category-id="{{ parent.id_category }}">
							{{ parent.name }}

							{% if parent.children|length > 0 %}
								<ul>
									{% for child in parent.children %}
										<li data-category-id="{{ child.id_category }}" data-jstree='{"opened":true}'>
											{{ child.name }}


											{% if child.children is defined %}
												<ul>
													{% for child2 in child.children %}
														<li data-jstree='{"opened":true}' data-category-id="{{ child2.id_category }}">
															{{ child2.name }}
														</li>
													{% endfor %}
												</ul>
											{% endif %}

										</li>
									{% endfor %}
								</ul>
							{% endif %}
						</li>
					{% endfor %}
				</ul>

			</div>
			<div class="mt-5">
				<p>Selected category:
				</p>
				<div id="selectedCategory"></div>
			</div>
		</div>

	</div>


	{# modal for adding new category #}
	{% include '@Modules/productimporter/templates/admin/components/category_crud_modal/add_category_modal.html.twig' %}
	{% include '@Modules/productimporter/templates/admin/components/category_crud_modal/edit_category_modal.html.twig' %}


{% endblock %}

{# load JS #}
{% block javascripts %}
	{{ parent() }}
{% endblock %}

{# load CSS #}
{% block stylesheets %}
	{{ parent() }}
{% endblock %}
